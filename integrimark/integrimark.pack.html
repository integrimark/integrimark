<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Download protected by IntegriMark</title><script src="https://unpkg.com/pdf-lib@1.16.0/dist/pdf-lib.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script><style>body{font-family:Arial,sans-serif;background-color:#e6f9e6;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}.frame{background-color:#b2e0b2;padding:20px;border-radius:10px;max-width:500px;max-height:400px;text-align:center;box-shadow:0 4px 8px rgba(0,0,0,.1)}h1{font-size:24px;margin-bottom:20px}footer{font-size:10px;position:absolute;bottom:10px;width:100%;text-align:center}a{color:#070;text-decoration:none}a:hover{text-decoration:underline}</style><script src="routing.js"></script></head><body><div class="frame"><h1>Download protected by IntegriMark</h1><p id="errorMessage" style="color: red; display: none;">You are not authorized to access this page.</p><form id="pdfForm" style="display: none;"><input type="hidden" id="fileUrl" value=""></form><p>Currently preparing a protected version of the file <strong id="filenameDisplay"></strong>...</p><a id="downloadLink" style="display: none;">Click here if the download doesn't start automatically</a></div><footer>Protected by IntegriMark, made with <span style="color: #e25555;">&hearts;</span> by <a href="https://directory.seas.upenn.edu/jeremie-o-lumbroso/">Jérémie Lumbroso, Penn CIS</a>.</footer><script>async function main(){let h=document.createElement("canvas").getContext("2d");var t=window.location.pathname;let e=t,r=integrimarkRoutes[e];if(r||(e=function(t){var e=t.split("/");for(let t=0;t<e.length;t++)if(e[t]){e.splice(t,1);break}return e.join("/")}(t),r=integrimarkRoutes[e]),!(r=r&&(t=integrimarkBaseURL,a=r,new URL(a,t).toString())))return document.getElementById("errorMessage").textContent="Invalid URL.",void(document.getElementById("errorMessage").style.display="block");document.getElementById("fileUrl").value=r;var a=new URLSearchParams(window.location.search),t=a.get("email"),o=a.get("key");if(!t||!o)return void(document.getElementById("errorMessage").style.display="block");n=t,o=o,n=CryptoJS.SHA256(n).toString().slice(0,32);var o=CryptoJS.AES.decrypt(o,n).toString(CryptoJS.enc.Utf8),n=await(await fetch(document.getElementById("fileUrl").value)).arrayBuffer(),n=new Uint8Array(n);const b=r.split("/").pop();var i=e;!async function(t,e,r,a){let o=t;if(e){var n=CryptoJS.AES.decrypt(CryptoJS.lib.WordArray.create(t).toString(CryptoJS.enc.Base64),e);o=new Uint8Array(n.sigBytes);for(let t=0;t<n.sigBytes;t++)o[t]=n.words[t>>>2]>>>24-t%4*8&255}var e=(t=await PDFLib.PDFDocument.load(o)).getPages(),i=`${(i=new Date).getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}@${String(i.getHours()).padStart(2,"0")}:`+String(i.getMinutes()).padStart(2,"0"),l=r.replace("@","[at]"),s=[.7,1,.7],c=`This document has been exclusively prepared for ${r} on ${i}. For any other person to view this document is a course violation.`;const d=20;i=l,v=d,h.font=v+"px Helvetica";var p=h.measureText(i).width;const g=d;for(const w of e){var{width:y,height:u}=w.getSize();let t=!1;var m=p/2;let a=0;for(let r=u;0<r;r-=1.2*g){let e=0;e+=a,t&&(e=-m,e-=a);for(let t=e;t<y;t+=p)w.drawText(l,{x:t,y:r,size:d,color:new PDFLib.rgb(s[0],s[1],s[2]),opacity:.45});t=!t,a+=2}w.drawText(c,{x:10,y:14,size:8,opacity:.5})}{const d=10,g=10;for(const S of e){var f=S.getSize()["height"];for(let t=f;0<t;t-=1.5)S.drawText(function(e){var r=["ba","la","na","mo","to","po","ki","ri","mi","fu","lu","du","su","pu","ka","ta","pa","bo"," "," "," "," "," "," "," "," "," "," "," "," "];let a="";for(let t=0;t<e;t++)a+=r[Math.floor(Math.random()*r.length)];return a}(400),{x:0,y:t,size:10,color:PDFLib.rgb(1,1,1),opacity:0})}}var v=b.split(".").slice(0,-1).join("."),i=b.split(".").pop(),e=v+`-${r}.`+i,v=(a&&(e=a.split("/").pop().split(".").slice(0,-1).join(".")+`-${r}.`+i),await t.save()),a=new Blob([v],{type:"application/pdf"}),r=URL.createObjectURL(a);(i=document.getElementById("downloadLink")).href=r,i.download=e,i.style.display="block",i.click()}(n,o,t,document.getElementById("filenameDisplay").textContent=i)}main();</script></body></html>